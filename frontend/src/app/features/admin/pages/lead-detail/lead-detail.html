<div class="detail-container">
  <div class="detail-content">
    <button (click)="goBack()" class="back-button">
      ← Zurück
    </button>

    @if (isLoading) {
      <div class="loading-state">
        Lade Lead-Details...
      </div>
    } @else if (lead) {
      <!-- Header -->
      <div class="detail-header">
        <div class="header-info">
          <h1>{{ lead.name }}</h1>
          <span [class]="'status-badge ' + lead.status">{{ lead.status }}</span>
        </div>
        <div class="lead-id">
          <div class="id-label">Lead ID</div>
          <div class="id-value">#{{ lead.id }}</div>
        </div>
      </div>

      <!-- Contact Section -->
      <div class="detail-section">
        <h2>Kontaktinformationen</h2>
        <div class="contact-grid">
          <div class="contact-item">
            <label>E-Mail</label>
            <div class="contact-value">
              <span>{{ lead.email }}</span>
              <button (click)="openEmail()" class="action-button email-button">
                E-Mail senden
              </button>
            </div>
          </div>
          <div class="contact-item">
            <label>WhatsApp</label>
            <div class="contact-value">
              <span>{{ lead.whatsapp_country_code }} {{ lead.whatsapp_number }}</span>
              <button (click)="openWhatsApp()" class="action-button whatsapp-button">
                WhatsApp öffnen
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tattoo Description -->
      <div class="detail-section">
        <h2>Tattoo-Beschreibung</h2>
        <div class="description-box">{{ lead.tattoo_description }}</div>

        @if (lead.reference_images && lead.reference_images.length > 0) {
          <div class="images-section">
            <div class="images-label">Referenzbilder ({{ lead.reference_images.length }})</div>
            <div class="images-grid">
              @for (image of lead.reference_images; track image) {
                <div class="image-item">
                  <img [src]="getImageUrl(image)" [alt]="'Referenzbild'" />
                </div>
              }
            </div>
          </div>
        }
      </div>

      <!-- Info Grid -->
      <div class="info-grid">
        <!-- Discount -->
        <div class="detail-section">
          <h2>Rabatt</h2>
          <div class="discount-display">
            <div class="discount-value">{{ lead.discount_percentage }}%</div>
            <div class="discount-label">Rabatt gewährt</div>
          </div>
          <div class="status-info">
            <div class="status-row">
              <span>E-Mail gesendet:</span>
              <span [class]="lead.email_sent ? 'status-yes' : 'status-no'">
                {{ lead.email_sent ? 'Ja' : 'Nein' }}
              </span>
            </div>
            <div class="status-row">
              <span>WhatsApp gesendet:</span>
              <span [class]="lead.whatsapp_sent ? 'status-yes' : 'status-no'">
                {{ lead.whatsapp_sent ? 'Ja' : 'Nein' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Campaign Data -->
        <div class="detail-section">
          <h2>Kampagnen-Daten</h2>
          <div class="campaign-info">
            @if (lead.lead_source) {
              <div class="info-row">
                <span class="info-key">Lead-Quelle</span>
                <span class="info-val">{{ lead.lead_source }}</span>
              </div>
            }
            @if (lead.utm_source) {
              <div class="info-row">
                <span class="info-key">UTM Source</span>
                <span class="info-val">{{ lead.utm_source }}</span>
              </div>
            }
            @if (lead.utm_medium) {
              <div class="info-row">
                <span class="info-key">UTM Medium</span>
                <span class="info-val">{{ lead.utm_medium }}</span>
              </div>
            }
            @if (lead.utm_campaign) {
              <div class="info-row">
                <span class="info-key">UTM Campaign</span>
                <span class="info-val">{{ lead.utm_campaign }}</span>
              </div>
            }
            @if (lead.ip_address) {
              <div class="info-row">
                <span class="info-key">IP-Adresse</span>
                <span class="info-val ip-address">{{ lead.ip_address }}</span>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Status Management -->
      <div class="detail-section">
        <h2>Status verwalten</h2>
        <div class="status-controls">
          <select [(ngModel)]="selectedStatus" class="status-select">
            @for (option of statusOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
          <button
            (click)="updateStatus()"
            [disabled]="isSavingStatus || selectedStatus === lead.status"
            class="update-button"
          >
            @if (isSavingStatus) {
              <span>Speichern...</span>
            } @else {
              <span>Status aktualisieren</span>
            }
          </button>
        </div>
      </div>

      <!-- Timestamps -->
      <div class="detail-section">
        <h2>Zeitstempel</h2>
        <div class="timestamp-grid">
          <div class="timestamp-item">
            <span class="timestamp-label">Erstellt am</span>
            <span class="timestamp-value">{{ formatDate(lead.created_at) }}</span>
          </div>
          <div class="timestamp-item">
            <span class="timestamp-label">Zuletzt aktualisiert</span>
            <span class="timestamp-value">{{ formatDate(lead.updated_at) }}</span>
          </div>
        </div>
      </div>
    } @else {
      <div class="loading-state">
        Lead nicht gefunden
      </div>
    }
  </div>
</div>
